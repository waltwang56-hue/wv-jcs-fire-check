<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>å†·åº“è®¾è®¡é˜¶æ®µï½œæ¶ˆé˜²è®¾è®¡åˆ°ä½æ€§å¿«é€Ÿç­›æŸ¥ï¼ˆ5åˆ†é’Ÿï¼‰</title>
  <style>
    body { font-family: -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"PingFang SC","Hiragino Sans GB","Microsoft YaHei",Arial,sans-serif; margin: 0; background: #f6f7fb; color: #111; }
    .wrap { max-width: 860px; margin: 0 auto; padding: 24px 16px 60px; }
    .card { background: #fff; border-radius: 14px; padding: 18px 18px; box-shadow: 0 6px 20px rgba(0,0,0,.06); margin-bottom: 14px; }
    h1 { font-size: 22px; margin: 0 0 8px; }
    .sub { color:#555; line-height:1.5; }
    .q { margin-top: 14px; padding-top: 14px; border-top: 1px solid #eee; }
    .q:first-of-type { border-top: none; padding-top: 0; }
    .qtitle { font-weight: 700; margin: 0 0 10px; }
    .opts label { display: block; padding: 8px 10px; border: 1px solid #e6e6e6; border-radius: 10px; margin: 8px 0; cursor: pointer; }
    .opts input { margin-right: 8px; }
    .btn { width: 100%; padding: 12px 14px; border: 0; border-radius: 12px; font-size: 16px; cursor: pointer; }
    .btn.primary { background: #111; color: #fff; }
    .btn.secondary { background: #eee; color: #111; margin-top: 10px; }
    .result { padding: 14px; border-radius: 12px; }
    .r-green { background:#e9f7ef; border:1px solid #cdebd9; }
    .r-yellow{ background:#fff7e6; border:1px solid #ffe1a6; }
    .r-red   { background:#fdeaea; border:1px solid #f6b9b9; }
    .mono { font-family: ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace; font-size: 12px; background:#0b1020; color:#e8ecff; padding: 12px; border-radius: 10px; overflow:auto; }
    .small { color:#666; font-size: 13px; line-height:1.5; }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>å†·åº“æ¶ˆé˜²è®¾è®¡æ˜¯å¦åˆ°ä½ï¼Ÿ</h1>
      <div class="sub">
        5 åˆ†é’Ÿå¿«é€Ÿç­›æŸ¥ï¼ˆè®¾è®¡é˜¶æ®µå¤±ç«é«˜é£é™©è¯†åˆ«ï¼‰ã€‚<br/>
        ä¸æ¶‰åŠæ¡æ–‡èƒŒè¯µï¼›åªåˆ¤æ–­æ˜¯å¦å·²è§¦å‘é«˜é£é™©è®¾è®¡å†³ç­–ã€‚
      </div>
    </div>

    <form id="form" class="card">
      <div id="questions"></div>

      <button type="submit" class="btn primary">æäº¤å¹¶æŸ¥çœ‹ç»“æœ</button>
      <button type="button" class="btn secondary" id="btnReset">æ¸…ç©ºé‡å¡«</button>
    </form>

    <div id="output" class="card" style="display:none;"></div>

    <div class="card">
      <div class="small">
        æç¤ºï¼šè¿™ 10 é¢˜ç”¨äºâ€œç¬¬ä¸€æ­¥ç­›æŸ¥â€ã€‚è‹¥ç»“æœä¸º ğŸŸ¡/ğŸ”´ï¼Œå»ºè®®è¿›å…¥â€œå…¨é‡è¯„ä¼°ï¼ˆ55 å› å­ï¼‰â€ä»¥å½¢æˆå¯äº¤ä»˜çš„å°½è°ƒç»“è®ºä¸æ•´æ”¹æ¸…å•ã€‚
      </div>
    </div>
  </div>

<script>
/** 10é¢˜é…ç½®ï¼ˆå¯ç›´æ¥ç»™codexæ‰©å±•ä¸ºå¤šè¯­è¨€/æ¥CRMï¼‰ */
const QUESTIONS = [
  { id:"Q1", text:"Q1ï¼šæ˜¯å¦å·²æŒ‰åŠŸèƒ½å’Œç«ç¾å±é™©æ€§æ­£ç¡®åˆ’åˆ†é˜²ç«åˆ†åŒºï¼Ÿ", type:"single", options:["æ˜¯","å¦","ä¸ç¡®å®š"] },
  { id:"Q2", text:"Q2ï¼šæ˜¯å¦å­˜åœ¨â€œå®é™…è´¯é€šï¼Œä½†å›¾çº¸ä»æŒ‰åˆ†åŒºå¤„ç†â€çš„æƒ…å†µï¼Ÿï¼ˆå­”æ´/é€šé“/ç©¿è¶Šæœªæœ‰æ•ˆå°å µç­‰ï¼‰", type:"single", options:["æ˜¯","å¦","ä¸ç¡®å®š"] },
  { id:"Q3", text:"Q3ï¼šä¿æ¸©ææ–™ç‡ƒçƒ§æ€§èƒ½ç­‰çº§æ˜¯å¦æ˜ç¡®å¹¶æ»¡è¶³æ¶ˆé˜²è®¾è®¡ç›®æ ‡ï¼Ÿ", type:"single", options:["æ˜¯","å¦","ä¸ç¡®å®š"] },
  { id:"Q4", text:"Q4ï¼šæ˜¯å¦è¯„ä¼°è¿‡ä¿æ¸©ææ–™åœ¨ç«ç¾ä¸­çš„å‚ä¸ç‡ƒçƒ§é£é™©ï¼ˆä¸æ­¢ç­‰çº§åˆè§„ï¼‰ï¼Ÿ", type:"single", options:["æ˜¯","å¦","ä¸ç¡®å®š"] },
  { id:"Q5", text:"Q5ï¼šåˆ¶å†·æœºæˆ¿ã€å‰è½¦/ç”µæ± å……ç”µé—´ç­‰æ˜¯å¦è¢«æ˜ç¡®è¯†åˆ«ä¸ºé‡ç‚¹é£é™©æˆ¿é—´ï¼Ÿ", type:"single", options:["æ˜¯","å¦","ä¸ç¡®å®š"] },
  { id:"Q6", text:"Q6ï¼šä¸Šè¿°æˆ¿é—´æ˜¯å¦è®¾ç½®æ°”ä½“æ³„æ¼/å¯ç‡ƒæ°”ä½“/æ¼ç”µç­‰æŠ¥è­¦è£…ç½®ï¼Ÿ", type:"single", options:["æ˜¯","å¦","ä¸ç¡®å®š"] },
  { id:"Q7", text:"Q7ï¼šæŠ¥è­¦åæ˜¯å¦å…·å¤‡è”åŠ¨æ§åˆ¶ï¼ˆè”åŠ¨æ’é£/åˆ‡ç”µ/åœæœºç­‰ï¼‰ï¼Ÿ", type:"single", options:["æ˜¯","å¦","ä¸ç¡®å®š"] },
  { id:"Q8", text:"Q8ï¼šæ˜¯å¦æ ¡æ ¸è¿‡å¼€å…³ï¼ˆæ–­è·¯å™¨/ç†”æ–­å™¨ï¼‰å®¹é‡ä¸ç”µç¼†/å¯¼çº¿æˆªé¢åŒ¹é…ï¼Ÿ", type:"single", options:["æ˜¯","å¦","ä¸ç¡®å®š"] },
  { id:"Q9", text:"Q9ï¼šæ˜¯å¦å­˜åœ¨â€œå¼€å…³é€‰å¤§ã€ç”µç¼†åå°â€çš„æƒ…å†µï¼Ÿ", type:"single", options:["æ˜¯","å¦","ä¸ç¡®å®š"] },
  { id:"Q10", text:"Q10ï¼šæ–½å·¥å‰æ˜¯å¦è¿›è¡Œè¿‡ç‹¬ç«‹ç¬¬ä¸‰æ–¹æ¶ˆé˜²/å¤±ç«é£é™©å®¡æŸ¥ï¼Ÿ", type:"single", options:["æ˜¯","å¦","ä¸ç¡®å®š"] },
];

/** æ¯é¢˜åˆ° CASEF-D v2.6 å› å­æ˜ å°„ï¼ˆç”¨äºå¯¼æµå…¨é‡è¯„ä¼°/æŠ¥å‘Šè§£é‡Šï¼‰ */
const FACTOR_MAP = {
  Q1: { primary:["F1.10"], related:["F1.9","F5.2"] },
  Q2: { primary:["F5.1","F5.2"], related:["F1.9","F4.4","F0.1.2"] },
  Q3: { primary:["F2.1"], related:["F2.9"] },
  Q4: { primary:["F2.2"], related:["F2.1","F0.1.3"] },
  Q5: { primary:["F3.5","F1.12"], related:["F3.2"] },
  Q6: { primary:["F3.6","F1.13","F4.6"], related:["F1.14"] },
  Q7: { primary:["F5.4"], related:["F1.13","F3.6","F4.6"] },
  Q8: { primary:["F4.5"], related:[] },
  Q9: { primary:["F4.5"], related:["F1.14"] },
  Q10:{ primary:["F5.4"], related:[] },
};

/** å…³é”®è§¦å‘è§„åˆ™ï¼ˆIHSé£æ ¼ï¼šä¸ç®—åˆ†ï¼Œåªåˆ†å±‚ï¼‰ */
function evaluate(answers){
  const keyHits = [];
  if (answers.Q2 === "æ˜¯") keyHits.push("Q2");
  if (answers.Q4 === "å¦") keyHits.push("Q4");
  if (answers.Q7 === "å¦") keyHits.push("Q7");
  if (answers.Q9 === "æ˜¯") keyHits.push("Q9");

  const noCount = Object.values(answers).filter(v => v === "å¦").length;
  const unkCount = Object.values(answers).filter(v => v === "ä¸ç¡®å®š").length;

  let level = "GREEN";
  if (keyHits.length >= 2) level = "RED";
  else if (keyHits.length === 1) level = "YELLOW";
  else if (unkCount >= 3 || noCount >= 4) level = "YELLOW"; // ä¿¡æ¯ç¼ºå¤±æˆ–å¦é¡¹åå¤šï¼šå»ºè®®è¿›å…¥å…¨é‡è¯„ä¼°

  const triggeredFactors = new Set();
  const relatedFactors = new Set();
  for (const [qid, val] of Object.entries(answers)){
    // åªè¦ä¸æ˜¯â€œæ˜¯â€ï¼Œå°±è®¤ä¸ºè¯¥é¢˜å­˜åœ¨é£é™©ä¿¡å·ï¼Œéœ€è¦è¿›å…¥åç»­å› å­æ·±æŒ–ï¼ˆæ›´åˆ©äºå¯¼æµï¼‰
    if (val !== "æ˜¯"){
      (FACTOR_MAP[qid]?.primary || []).forEach(x => triggeredFactors.add(x));
      (FACTOR_MAP[qid]?.related || []).forEach(x => relatedFactors.add(x));
    }
  }

  const result = {
    level,
    keyHits,
    answers,
    triggered_factors: Array.from(triggeredFactors),
    related_factors: Array.from(relatedFactors),
    suggestion:
      level === "RED"
        ? "ğŸ”´ å½“å‰è®¾è®¡å·²è§¦å‘ç³»ç»Ÿæ€§å¤±ç«é«˜é£é™©å†³ç­–ï¼šå»ºè®®åœ¨æ–½å·¥å‰ç«‹å³è¿›è¡Œâ€œå…¨é‡è¯„ä¼°ï¼ˆ55å› å­ï¼‰â€å¹¶å½¢æˆæ•´æ”¹é—­ç¯ã€‚"
        : level === "YELLOW"
          ? "ğŸŸ¡ å½“å‰è®¾è®¡å­˜åœ¨éœ€å…³æ³¨çš„é£é™©ä¿¡å·æˆ–ä¿¡æ¯ä¸å……åˆ†ï¼šå»ºè®®è¿›å…¥â€œå…¨é‡è¯„ä¼°ï¼ˆ55å› å­ï¼‰â€å®šä½Topé£é™©ç‚¹ã€‚"
          : "ğŸŸ¢ æš‚æœªå‘ç°æ˜æ˜¾ç³»ç»Ÿæ€§å¤±ç«é£é™©ï¼šå»ºè®®ä¿ç•™è¯æ®é“¾ï¼Œå¹¶åœ¨å…³é”®èŠ‚ç‚¹åšç¬¬ä¸‰æ–¹å¤æ ¸ã€‚"
  };
  return result;
}

function renderQuestions(){
  const container = document.getElementById("questions");
  container.innerHTML = "";
  QUESTIONS.forEach((q, idx) => {
    const div = document.createElement("div");
    div.className = "q";
    div.innerHTML = `
      <div class="qtitle">${q.text}ï¼ˆå•é€‰é¢˜ï¼‰</div>
      <div class="opts">
        ${q.options.map((opt, i) => `
          <label>
            <input type="radio" name="${q.id}" value="${opt}" required />
            ${opt}
          </label>
        `).join("")}
      </div>
    `;
    container.appendChild(div);
  });
}

function collectAnswers(formEl){
  const answers = {};
  QUESTIONS.forEach(q => {
    const v = formEl.querySelector(`input[name="${q.id}"]:checked`)?.value;
    answers[q.id] = v || "";
  });
  return answers;
}

function showResult(res){
  const out = document.getElementById("output");
  out.style.display = "block";

  let cls = "r-green", title="ğŸŸ¢ æš‚æœªå‘ç°æ˜æ˜¾ç³»ç»Ÿæ€§å¤±ç«é£é™©";
  if (res.level === "YELLOW"){ cls="r-yellow"; title="ğŸŸ¡ éœ€å…³æ³¨ï¼šå»ºè®®è¿›å…¥å…¨é‡è¯„ä¼°"; }
  if (res.level === "RED"){ cls="r-red"; title="ğŸ”´ é«˜é£é™©ï¼šå»ºè®®ç«‹å³è¿›å…¥å…¨é‡è¯„ä¼°"; }

  out.innerHTML = `
    <div class="result ${cls}">
      <div style="font-weight:800; font-size:18px; margin-bottom:8px;">${title}</div>
      <div class="small">${res.suggestion}</div>
      <div class="small" style="margin-top:10px;">
        å…³é”®è§¦å‘é¢˜ï¼š${res.keyHits.length ? res.keyHits.join(", ") : "æ— "}
      </div>
      <div class="small" style="margin-top:8px;">
        å»ºè®®è¿›å…¥å…¨é‡è¯„ä¼°ä¼˜å…ˆå…³æ³¨å› å­ï¼ˆPrimaryï¼‰ï¼š<b>${res.triggered_factors.join(", ") || "æ— "}</b><br/>
        å…³è”å› å­ï¼ˆRelatedï¼‰ï¼š${res.related_factors.join(", ") || "æ— "}
      </div>
    </div>

    <div style="margin-top:12px; font-weight:700;">JSONï¼ˆå¯ç›´æ¥ç»™åç«¯/CRM/å…¨é‡è¯„ä¼°è·³è½¬ç”¨ï¼‰</div>
    <div class="mono" id="jsonBox"></div>
  `;

  document.getElementById("jsonBox").textContent = JSON.stringify(res, null, 2);
  window.scrollTo({ top: out.offsetTop - 10, behavior: "smooth" });
}

document.getElementById("btnReset").addEventListener("click", () => {
  document.getElementById("form").reset();
  document.getElementById("output").style.display = "none";
});

document.getElementById("form").addEventListener("submit", (e) => {
  e.preventDefault();
  const answers = collectAnswers(e.target);
  const result = evaluate(answers);

  // å¯é€‰ï¼šæäº¤åˆ°ä½ ä»¬åç«¯ï¼ˆç•™ç»™codexæ¥CRMï¼‰
  // fetch("/api/submit", { method:"POST", headers:{ "Content-Type":"application/json" }, body: JSON.stringify(result) })

  showResult(result);
});

renderQuestions();
</script>
</body>
</html>
